<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Register User</title>

<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
body {
    font-family: sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #f5f5f5;
}
#box {
    background: white;
    padding: 25px;
    border-radius: 12px;
    width: 90%;
    max-width: 350px;
    text-align: center;
    box-shadow: 0 6px 14px rgba(0,0,0,0.15);
}
</style>
</head>

<body>
<div id="box">
    <h2>ลงทะเบียนผู้ใช้</h2>

    <!-- ปุ่ม Sign in with Google -->
    <div id="gSignIn"></div>

    <p id="result" style="margin-top:15px; color:green; font-weight:bold;"></p>
</div>

<script>
function handleCredentialResponse(response) {
    const data = parseJwt(response.credential);

    const email = data.email;
    const name  = data.name;

    // ส่งข้อมูลไป Apps Script
    fetch("https://script.google.com/macros/s/AKfycbzXgbcoyebiSeGzf22jcT-LaEWDJF8zdnKTBHGk_qunGypUDcDby-ZQ-xNzFwGyh6BO/exec?email=" 
          + encodeURIComponent(email) 
          + "&name=" + encodeURIComponent(name))
    .then(res => res.json())
    .then(r => {
        document.getElementById("result").textContent = "ลงทะเบียนสำเร็จ!";
    })
    .catch(err => alert("ส่งข้อมูลไม่สำเร็จ: " + err));
}

// อ่านข้อมูล Google JWT
function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    return JSON.parse(decodeURIComponent(escape(atob(base64))));
}

// โหลดปุ่ม Google Sign-In
window.onload = function () {
    google.accounts.id.initialize({
        client_id: "YOUR_CLIENT_ID",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
        document.getElementById("gSignIn"),
        { theme: "filled_blue", size: "large", shape: "pill" }
    );
};
</script>

</body>
</html>
